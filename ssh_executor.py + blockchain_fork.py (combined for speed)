# ssh_executor.py + blockchain_fork.py
import paramiko
from web3 import Web3

w3 = Web3(Web3.HTTPProvider("http://localhost:8545"))  # private geth on DGX

def run_on_pc(command, proof):
    ssh = paramiko.SSHClient()
    ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
    ssh.connect("192.168.1.100", username="doctor", key_filename="/home/dgx/.ssh/id_rsa")
    ssh.exec_command(f"python3 /home/doctor/update_ehr.py --cmd '{command}' --proof {proof.hex()}")

def new_branch(command, result, proof):
    tx_hash = w3.eth.send_transaction({
        'to': '0xYourContractAddress',
        'from': w3.eth.default_account,
        'data': w3.to_hex(text=f"BRANCH:{command}:{result['probability']}:{proof.hex()}")
    })
    print(f"Chain forked: {tx_hash.hex()}")
